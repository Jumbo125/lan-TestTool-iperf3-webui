<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Speedtest GUI</title>
    <link rel="stylesheet" href="/static/styles.css" />
    <script src="/static/js/gauge.min.js"></script>
    <style>
      :root {
   --primary: {{ theme.primary|default('#f59e0b') }};            /* gold */
--secondary: {{ theme.secondary|default('#7c2d12') }};        /* deep warm brown/red */
--background: {{ theme.background|default('#1f1407') }};      /* dark warm (statt blau) */
--text: {{ theme.text|default('#ffffff') }};
--card_bg: {{ theme.card_bg|default('rgba(255, 255, 255, 0.06)') }};
--card_border: {{ theme.card_border|default('rgba(245, 158, 11, 0.22)') }};
--input_bg: {{ theme.input_bg|default('rgba(255, 255, 255, 0.08)') }};
--hover_bg: {{ theme.hover_bg|default('rgba(245, 158, 11, 0.10)') }};

--speedometer_gradient_1: {{ theme.speedometer_gradient_1|default('#fbbf24') }}; /* honey */
--speedometer_gradient_2: {{ theme.speedometer_gradient_2|default('#f59e0b') }}; /* gold */
--speedometer_gradient_3: {{ theme.speedometer_gradient_3|default('#f97316') }}; /* orange */

      }

      body {
          background: var(--background);
          color: var(--text);
          width: fit-content;
      }

      .field label,
      #runBtn,
      #output h2,
      footer p {
          font-weight: 600;
      }

      .number div {
          font-weight: 700;
      }

      /* Select styling like input */
      select {
          width: 100%;
          padding: 10px 12px;
          border-radius: 10px;
          border: 1px solid var(--card_border);
          background: var(--input_bg);
          color: var(--text);
          outline: none;
      }

      select:focus {
          border-color: var(--primary);
      }

      .ok { color: #22c55e; }      /* grÃ¼n */
      .warn { color: #f59e0b; }    /* gelb */
      .bad { color: #ef4444; }     /* rot */

      .hint {
        font-size: 12px;
        font-weight: 600;
        opacity: 0.75;
        margin-left: 6px;
      }

      .stats-note {
        opacity: .8;
        font-size: 12px;
        margin-top: 6px;
        line-height: 1.3;
      }
    </style>
  </head>

  <body>
    <header>
      <div class="header-content">
        <div id="logo-gallery" class="logo-banner">
          {% if logos %} {% for logo in logos %}
          <img class="logo" src="{{ logo }}" alt="Logo" />
          {% endfor %} {% endif %}
        </div>
        <div class="title-wrapper">
          <div class="title">
            <h1>iPerf3 <span class="gradient-text">Lan-Cable Checker</span></h1>
          </div>
          <p id="iperf_version" class="subtitle">Loading version...</p>
          <p>Bitte nach jedem Check Seite neu Laden.</p>
        </div>
      </div>
    </header>

    <main class="container">
      <!-- Speedometer Section -->
      <div class="speedometer-section">
        <div class="speedometer-container">
          <canvas id="speedometer" class="speedometer"></canvas>
          <div class="number">
            <div id="current-value">0</div>
            <div class="units">Mbps</div>
          </div>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Status</div>
            <div class="stat-value status">Ready</div>
          </div>

          <div class="stat-card">
            <div class="stat-label">Average</div>
            <div class="stat-value avg_speed">--</div>
          </div>

          <div class="stat-card">
            <div class="stat-label">Maximum</div>
            <div class="stat-value max_speed">--</div>
          </div>

          <!-- Link / Adapter -->
          <div class="stat-card">
            <div class="stat-label">Link</div>
            <div class="stat-value" id="linkInfo" title="Link Speed/Status vom Adapter">--</div>
          </div>

          <!-- Windows: ReceivedErrors + OutboundErrors (Î”); Linux: rx_errors/tx_errors (Î”) -->
          <div class="stat-card">
            <div class="stat-label">Packet Errors Î”</div>
            <div class="stat-value" id="pktErrDelta"
                 title="Î” seit Teststart. Windows: ReceivedErrors + OutboundErrors. Linux: rx_errors/tx_errors (falls verfÃ¼gbar).">
              0
            </div>
          </div>

          <!-- Windows: Discarded; Linux: dropped/discarded -->
          <div class="stat-card">
            <div class="stat-label">Discards/Drops Î”</div>
            <div class="stat-value" id="dropDelta"
                 title="Î” seit Teststart. Windows: ReceivedDiscarded + OutboundDiscarded. Linux: rx_dropped/tx_dropped (falls verfÃ¼gbar).">
              0
            </div>
          </div>

          <!-- PHY-level (mostly Linux) -->
          <div class="stat-card">
            <div class="stat-label">CRC/FCS Î” <span class="hint">(PHY)</span></div>
            <div class="stat-value" id="crcDelta"
                 title="Echte PHY-Fehler (rx_crc_errors/rx_fcs_errors) sind meist nur unter Linux/mit passenden Treibern verfÃ¼gbar. Unter Windows oft n/a.">
              n/a
            </div>
          </div>

          <!-- Simple heuristic badge (optional, set by JS) -->
          <div class="stat-card">
            <div class="stat-label">Quality</div>
            <div class="stat-value" id="qualityBadge"
                 title="Heuristische Ampel basierend auf Î”-Fehlern unter Last (optional).">
              --
            </div>
          </div>
        </div>

        <div class="stats-note">
          <span class="ok">OK</span>: 0 Fehler Â·
          <span class="warn">Warn</span>: einzelne Fehler unter Last Â·
          <span class="bad">Bad</span>: Fehler steigen schnell / Link instabil
        </div>
      </div>

      <!-- Controls Section -->
      <div class="controls-section">
         <div class="card">
          <div class="input-group">
            <div class="input-wrapper">
              <label for="target">Target IP</label>
              <input
                type="text"
                id="target"
                value="192.168.10.2"
                placeholder="Enter IP address"
              />
            </div>
            <div class="input-wrapper input-small">
              <label for="port">Port</label>
              <input
                type="text"
                id="port"
                value="{{ default_port }}"
                placeholder="5201"
              />
            </div>
            <div class="input-wrapper input-small">
              <label for="iface">Interface</label>
              <select id="iface" data-default="{{ default_iface }}"></select>
            </div>
          </div>

          <div class="field">
            <label>Protocol</label>
            <div class="toggle-container">
              <button id="tcpBtn" class="toggle-btn active">
                <span class="toggle-label">TCP</span>
              </button>
              <button id="udpBtn" class="toggle-btn">
                <span class="toggle-label">UDP</span>
              </button>
            </div>
          </div>

          <div class="field">
            <label>Mode</label>
            <div class="toggle-container">
              <button id="uploadBtn" class="toggle-btn active">
                <svg
                  class="toggle-icon"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"
                  />
                </svg>
                <span class="toggle-label">Upload</span>
              </button>
              <button id="downloadBtn" class="toggle-btn">
                <svg
                  class="toggle-icon"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"
                  />
                </svg>
                <span class="toggle-label">Download</span>
              </button>
            </div>
          </div>

          <div class="field">
            <label>Units</label>
            <div class="toggle-container three-col">
              <button id="Kbits" class="unit-btn toggle-btn">Kbits</button>
              <button id="Mbits" class="unit-btn toggle-btn active">Mbits</button>
              <button id="Gbits" class="unit-btn toggle-btn">Gbits</button>
            </div>
          </div>

          <div class="field">
            <label for="streams">Parallel Streams</label>
            <input type="number" id="streams" min="1" max="10" value="8" />
          </div>

          <div class="field" id="bandwidth-field" style="display: none">
            <label for="bandwidth">
              Bandwidth per Stream <span class="hint">(0 for maximum)</span>
            </label>
            <input type="string" id="bandwidth" value="0" />
          </div>
        </div>

        <button id="runBtn" class="run-btn">
          <svg
            class="btn-icon"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 10V3L4 14h7v7l9-11h-7z"
            />
          </svg>
          Run Speed Test
        </button>
      </div>

      <!-- Output Section -->
      <div class="card output-card" id="output">
        <h2>
          <svg
            class="section-icon"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
            />
          </svg>
          Output
        </h2>
        <pre id="result">Waiting for input...</pre>
      </div>
    </main>

    <footer>
      <p>
        Forked &amp; adapted with ðŸ’œ by
        <a href="https://github.com/Jumbo125" target="_blank" rel="noopener noreferrer">Jumbo125</a>
        â€” original by
        <a href="https://github.com/MaddyDev-glitch" target="_blank" rel="noopener noreferrer">MaddyDev-glitch</a>
      </p>
    </footer>

    <!-- Speedtest Running Overlay -->
    <div id="speedtestOverlay" class="speedtest-overlay" style="display:none" role="dialog" aria-modal="true" aria-label="Speedtest lÃ¤uft">
      <div class="speedtest-modal">
        <div class="speedtest-spinner" aria-hidden="true"></div>

        <div class="speedtest-title">Speed Test lÃ¤uftâ€¦</div>
        <div id="speedtestOverlayText" class="speedtest-text">Starte iPerfâ€¦</div>

        <button id="speedtestOverlayClose" class="speedtest-close" style="display:none" type="button">
          SchlieÃŸen
        </button>
      </div>
    </div>

    <script type="module" src="/static/js/main.js"></script>
  </body>
</html>
